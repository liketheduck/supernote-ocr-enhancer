# Supernote OCR Enhancer - Environment Configuration
# Copy this to .env.local and customize for your setup

# =============================================================================
# STORAGE MODE CONFIGURATION
# =============================================================================
# Choose how you sync your Supernote files. Options:
#
# 1. personal_cloud (DEFAULT) - Self-hosted Supernote Cloud sync server
#    Configure: STORAGE_MODE, MYSQL_PASSWORD, SUPERNOTE_DATA_PATH
#    Run with: docker compose up -d
#
# 2. mac_app - Official Supernote Mac app
#    Configure: MACAPP_NOTES_PATH, MACAPP_DATABASE_PATH (or use --auto)
#    Run with: ./run-with-macapp.sh
#
# 3. none - Manual file transfer (USB, file manager)
#    Configure: SUPERNOTE_DATA_PATH only
#    Run with: docker compose run --rm ocr-enhancer python /app/main.py
#
# Leave blank for auto-detection based on other settings
# STORAGE_MODE=

# =============================================================================
# OPTION 1: Personal Cloud (Self-hosted Sync Server)
# =============================================================================
# If you use the self-hosted Supernote Cloud sync server (recommended for power users)

# Path to your Supernote data directory (where .note files are synced)
# This is mounted into the Docker container
SUPERNOTE_DATA_PATH=/path/to/your/supernote/data

# REQUIRED FOR PERSONAL CLOUD: Enable sync mode and provide MySQL password
# STORAGE_MODE=personal_cloud
# MYSQL_PASSWORD=your_password  # Get with: docker exec supernote-mariadb env | grep MYSQL_PASSWORD

# =============================================================================
# OPTION 2: Supernote Mac App
# =============================================================================
# If you use the official Supernote Mac app instead of Personal Cloud
#
# TIP: Run ./run-with-macapp.sh --auto to auto-detect these paths!
#
# The Mac app stores files in:
# ~/Library/Containers/com.ratta.supernote/Data/Library/Application Support/
# com.ratta.supernote/<USER_ID>/
#
# Your USER_ID is a long numeric string (visible in that directory)

# Path to the Mac app's Supernote folder containing your .note files
# Example: ~/Library/Containers/com.ratta.supernote/.../123456789/Supernote
# MACAPP_NOTES_PATH=

# Path to the Mac app's SQLite database (usually auto-detected)
# Example: ~/Library/Containers/com.ratta.supernote/.../123456789/supernote.db
# MACAPP_DATABASE_PATH=

# =============================================================================
# Container Configuration
# =============================================================================

# Container timezone (for cron scheduling)
# Set to your local timezone so hourly cron jobs run at expected local times
# Common values: America/New_York, America/Los_Angeles, America/Chicago,
#                America/Denver, Europe/London, Asia/Tokyo
# Default: UTC if not set
# TZ=America/New_York

# =============================================================================
# OCR API Configuration
# =============================================================================

# OCR API endpoint (MLX-VLM server)
# Use host.docker.internal for Docker on Mac/Windows
OCR_API_URL=http://host.docker.internal:8100

# =============================================================================
# Processing Settings
# =============================================================================

# Processing interval: 0 = single run, >0 = continuous with interval in seconds
PROCESS_INTERVAL=0

# Log level: DEBUG, INFO, WARNING, ERROR
LOG_LEVEL=INFO

# Write OCR data back to .note files
WRITE_TO_NOTE=true

# Create backups before modifying files
CREATE_BACKUPS=true

# FILE_RECOGN_TYPE controls what the Supernote device does with recognition:
#   "0"    = Disable device realtime OCR (device won't OCR new strokes)
#   "1"    = Enable device realtime OCR (device OCRs new strokes) [DEFAULT]
#   "keep" = Inject OCR but preserve file's existing TYPE setting (0 or 1)
#
# NOTE: Both "0" and "1" allow searching existing OCR data!
# Use "0" if you want our better OCR to be the only OCR (no device override)
# Use "1" if you want immediate (basic) OCR for new content before our enhancer runs
# FILE_RECOGN_TYPE=1

# OCR_PDF_LAYERS enables OCR for PDF imports and custom background layers
# When true (default), extracts embedded PNG images from BGLAYER for pages
# that use custom styles (e.g., PDF imports) and OCRs them
# Set to false to skip these files
# OCR_PDF_LAYERS=true

# =============================================================================
# Text Export Settings
# =============================================================================
# Export OCR text to local .txt files, preserving folder structure.
# This is useful for local search, backup, or integration with other tools.
#
# Enable text export (default: false)
# OCR_TXT_EXPORT_ENABLED=false
#
# Path where .txt files will be saved. The folder structure of your notes
# will be mirrored here. Files will have the same name as the .note files
# but with a .txt extension.
#
# Example: If your note is at:
#   /Volumes/Data/Supernote/user/Note/Work/Meeting.note
# And you set:
#   SUPERNOTE_DATA_PATH=/Volumes/Data/Supernote
#   OCR_TXT_EXPORT_PATH=~/Documents/SupernoteText
# The text will be saved to:
#   ~/Documents/SupernoteText/user/Note/Work/Meeting.txt
#
# OCR_TXT_EXPORT_PATH=~/Documents/SupernoteText

# =============================================================================
# PDF Export Settings
# =============================================================================
# Export searchable PDFs with embedded OCR layer.
# The visible layer shows your handwriting, the invisible layer contains
# searchable OCR text with bounding boxes.
#
# Enable PDF export (default: false)
# OCR_PDF_EXPORT_ENABLED=false
#
# Path where PDFs will be saved. The folder structure of your notes
# will be mirrored here.
# OCR_PDF_EXPORT_PATH=~/Documents/SupernotePDFs

# =============================================================================
# Logseq Export Settings
# =============================================================================
# Export notes as Logseq markdown pages with links to PDFs.
# This integrates your Supernote notes into your Logseq knowledge graph.
#
# IMPORTANT: Logseq export works INDEPENDENTLY of OCR_PDF_EXPORT_ENABLED.
# PDFs are automatically generated for Logseq even if PDF export is disabled.
#
# Enable Logseq export (default: false)
# LOGSEQ_EXPORT_ENABLED=false
#
# Path to Logseq pages directory. Markdown files will be created here,
# preserving your Supernote folder structure under a 'supernote' namespace.
#
# Example: If your Logseq graph is at ~/Documents/logseq
# Set: LOGSEQ_PAGES_PATH=~/Documents/logseq/pages/supernote
#
# LOGSEQ_PAGES_PATH=~/Documents/logseq/pages/supernote
#
# Path to Logseq assets directory. PDFs will be generated/copied here.
# This should be your Logseq graph's assets folder.
#
# Example: LOGSEQ_ASSETS_PATH=~/Documents/logseq/assets
#
# LOGSEQ_ASSETS_PATH=~/Documents/logseq/assets
#
# How it works:
# - If OCR_PDF_EXPORT_ENABLED=true: PDF is generated first, then copied to Logseq assets
# - If OCR_PDF_EXPORT_ENABLED=false: PDF is generated directly in Logseq assets
# Either way, the PDF link in Logseq will work correctly.
#
# Features included in Logseq export:
# - Link to PDF in assets
# - Processing date as journal link
# - OCR confidence percentage
# - Auto-generated tags based on folder structure and content
# - Auto-generated summary (for notes with >3 pages)
# - Full OCR text with formatting preserved

# =============================================================================
# AI Text Processing Settings
# =============================================================================
# Use Qwen LLM to clean up OCR text and generate intelligent summaries.
# This improves text quality before exporting to TXT and Logseq.
#
# IMPORTANT: Requires Qwen model loaded in OCR API.
# Start OCR API with: OCR_MODEL_PATH=mlx-community/Qwen2.5-VL-7B-Instruct-8bit
#
# Enable AI text cleanup (default: false)
# AI_TEXT_CLEANUP_ENABLED=false
#
# What it does:
# - Fixes obvious OCR errors (character confusion, fragmented words)
# - Corrects punctuation and spacing
# - Preserves paragraph structure and formatting
# - Generates intelligent summaries (instead of simple extraction)
#
# Performance impact:
# - Cleanup: ~2-5 seconds per page
# - Summary: ~2-3 seconds per note (only for multi-page notes)
# - Only runs if Qwen model is loaded, otherwise falls back to original text
#
# Note: If disabled, summaries use simple sentence extraction
